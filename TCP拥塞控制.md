## TCP 拥塞控制

> TCP拥塞控制是传输控制协议（Transmission Control Protocol）避免网络拥塞的算法，是互联网上主要的一个拥塞控制措施。 它使用一套基于**线增积减**模式的多样化网络拥塞控制方法（包括慢启动和拥塞窗口等模式）来控制拥塞。 

从定义可以看出，TCP拥塞控制主要的目的在于“避免网络拥塞”。你可能会问：什么叫“网络拥塞”？

> 拥塞的主要成因是**数据发送方**投放到网络中的数据超出了网络的承载能力，网络设备接口往往都有**缓冲区**，超量的数据无法从瓶颈路径发送，只好在缓存区排队，而缓冲区的大小有**限制**，积压的数据量超出缓存区大小，就会发生丢弃。

所以我们知道，如果要避免拥塞，就需要发送方按照接收网络方的流量承载能力发送数据，那究竟有什么方法可以做到这点呢？发送端是怎么获得接收网络的流量承载能力的呢？进一步，发送端能否动态监测接收网络的承载能力，从而动态调整发送速率呢？当然有办法。以下就是常用的拥塞控制方法的组成：
1.慢启动；2.快速重传；3.快速恢复；

 **1. 慢启动**
慢启动其实就是试探试增长并调整发送速率（也就是**发送窗口**，“窗口”一词在中文情境下比较难理解，但在英文中有“机会”的意思。如果把它理解为“时机，机会”的话可以更容易理解它和“速率”的关系。假设发送窗口初始化为cwnd）。开始时，cwnd初始化为1个**MSS**（Maximum Segment Size， 最大报文长度，是TCP数据包每次能够传输的最大数据分段）大小，然后随着ACK线性递增，每当经过一个**RTT**（Round Trip Time， 也就是一个数据包从发出去到回来的时间） 又指数上升，最后进入拥塞避免阶段。
详情如下：
1. 连接建好的开始先初始化cwnd = 1MSS，表明可以传一个MSS大小的数据
2. 每当收到一个ACK，cwnd++; 呈线性上升
3. 每当过了一个RTT，cwnd = cwnd*2; 呈指数让升
4. 当cwnd >= ssthresh（慢启动门限）时，就会进入“拥塞避免算法”

**2.拥塞避免算法**
通过上面对“慢启动”的介绍，我们知道，发送窗口cwnd不能无限制的增长，否则接收网络将无法承受。所以在上面最后一步中，当cwnd达到慢启动门限ssthresh后，将需要进行拥塞避免调控。
这一算法的基本思想是改指数增长为线性增长。到这个阶段，每当收到一个RTT，窗口递增1。但也不是无限递增，如果发现出现了网络拥塞（基本上是丢包），这时候将调整ssthresh（ssthresh = ssthresh/2）和cwnd(cwnd = 1)，重新进入慢启动阶段。

